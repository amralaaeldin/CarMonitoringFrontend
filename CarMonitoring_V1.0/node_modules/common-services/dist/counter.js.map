{"version":3,"sources":["../src/counter.ts"],"names":["noop","DEFAULT_COUNTER","firstCount","singleton","initCounter","COUNTER","log","currentCount","counter"],"mappings":";;;;;;;AAAA;;AAGA,SAASA,IAAT,GAAgB,CAAE;;AAalB,MAAMC,eAAe,GAAG;AACtBC,EAAAA,UAAU,EAAE;AADU,CAAxB;AAIA;;;;;;;;;;;eAWe,yBAAQ;AAAEC,EAAAA,SAAS,EAAE;AAAb,CAAR,EAA6B,6BAAYC,WAAZ,CAA7B,EAAuD,IAAvD,C;AAEf;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,eAAeA,WAAf,CAA2B;AACzBC,EAAAA,OAAO,GAAGJ,eADe;AAEzBK,EAAAA,GAAG,GAAGN;AAFmB,CAA3B,EAGwD;AACtD,MAAIO,YAAY,GAAGF,OAAO,CAACH,UAA3B;AAEAI,EAAAA,GAAG,CAAC,OAAD,EAAU,mCAAV,CAAH;AAEA,SAAOE,OAAP;AAEA;;;;;;;;;;;;;AAYA,iBAAeA,OAAf,GAAyB;AACvBF,IAAAA,GAAG,CAAC,OAAD,EAAU,sBAAV,EAAkCC,YAAlC,CAAH;AACA,WAAOA,YAAY,EAAnB;AACD;AACF","sourcesContent":["import { autoService, options } from 'knifecycle';\nimport type { LogService } from './log';\n\nfunction noop() {}\n\nexport interface CounterService {\n  (): Promise<number>;\n}\n\nexport type CounterServiceConfig = {\n  COUNTER?: { firstCount: number };\n};\nexport type CounterServiceDependencies = CounterServiceConfig & {\n  log?: LogService;\n};\n\nconst DEFAULT_COUNTER = {\n  firstCount: 1,\n};\n\n/* Architecture Note #1.6: Counter\n\nThe `counter` service provide a simple, local and\n stubbable counter.\n\nThe count are returned asynchronously in order\n to be easily maintained across several instances\n if needed later via another service with the same\n surface API.\n*/\n\nexport default options({ singleton: true }, autoService(initCounter), true);\n\n/**\n * Instantiate the counter service\n * @name initCounter\n * @function\n * @param  {Object}   services\n * The services to inject\n * @param  {Object}   [services.COUNTER=DEFAULT_COUNTER]\n * An optional configuration object\n * @param  {Object}   [services.log=noop]\n * An optional logging function\n * @return {Promise<Function>}\n * A promise of the counter function\n * @example\n * import initCounter from 'common-services/dist/counter';\n *\n * const counter = await initCounter({\n *   COUNTER: { firstCount: 1 },\n *   log: console.log.bind(console),\n * });\n */\nasync function initCounter({\n  COUNTER = DEFAULT_COUNTER,\n  log = noop,\n}: CounterServiceDependencies): Promise<CounterService> {\n  let currentCount = COUNTER.firstCount;\n\n  log('debug', 'ðŸ“‡ - Counter service initialized.');\n\n  return counter;\n\n  /**\n   * Returns the current count and increment the counter\n   * @return {Promise<number>}\n   * A promise of the current count\n   * @example\n   * console.log([\n   *   counter(),\n   *   counter(),\n   *   counter(),\n   * ]);\n   * // Prints: 1,2,3\n   */\n  async function counter() {\n    log('debug', 'ðŸ“‡ - Picked a count:', currentCount);\n    return currentCount++;\n  }\n}\n"],"file":"counter.js"}